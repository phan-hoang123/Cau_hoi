<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quiz Player</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap');
        
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Nunito', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 480px;
            min-height: 400px; /* G·ªçn h∆°n v√¨ kh√¥ng c·∫ßn ch·ªó cho BXH */
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
            padding-bottom: 20px;
        }

        .screen { display: none; padding: 2rem; flex: 1; flex-direction: column; justify-content: center; animation: fadeIn 0.5s ease; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Login */
        .login-box { text-align: center; }
        .logo-text { font-size: 3rem; font-weight: 900; color: #e73c7e; margin-bottom: 10px; }
        input[type="text"] { width: 100%; padding: 15px; margin: 20px 0; border: 2px solid #ddd; border-radius: 12px; font-size: 1.1rem; text-align: center; outline: none; }
        input[type="text"]:focus { border-color: #23a6d5; }
        .btn { background: linear-gradient(to right, #23a6d5, #23d5ab); color: white; border: none; padding: 15px; width: 100%; border-radius: 50px; font-size: 1.2rem; font-weight: 800; cursor: pointer; box-shadow: 0 5px 15px rgba(35, 213, 171, 0.4); }
        .btn:active { transform: scale(0.95); }

        /* Quiz */
        .quiz-header h2 { font-size: 1.4rem; margin-bottom: 2rem; text-align: center; color: #333; font-weight: 700; }
        ul { display: flex; flex-direction: column; gap: 15px; }
        ul li { list-style: none; padding: 15px; border: 2px solid #f0f0f0; border-radius: 12px; font-weight: 600; cursor: pointer; background: white; transition: 0.2s; }
        ul li:hover { border-color: #23a6d5; transform: translateX(5px); }
        ul li.correct { background: #d4edda; border-color: #28a745; color: #155724; }
        ul li.wrong { background: #f8d7da; border-color: #dc3545; color: #721c24; }
        ul.disabled li { pointer-events: none; opacity: 0.6; }

        /* Result Screen (ƒê√£ b·ªè BXH) */
        .result-box { text-align: center; }
        .score-circle { width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(to bottom right, #e73c7e, #ee7752); display: flex; justify-content: center; align-items: center; margin: 0 auto 20px; color: white; font-size: 3.5rem; font-weight: 900; box-shadow: 0 10px 20px rgba(231, 60, 126, 0.4); }
        .info-text { color: #555; margin-top: 20px; font-size: 1.1rem; }
        .sv-msg { background: #f1f2f6; padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 0.9rem; color: #2f3542; }

        /* Loading */
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 99; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .progress-container { height: 8px; background: #f0f0f0; width: 100%; position: absolute; top: 0; left: 0; }
        .progress-fill { height: 100%; background: linear-gradient(to right, #23a6d5, #23d5ab); width: 0%; transition: width 0.4s ease; }
    </style>
</head>
<body>

<div id="loading"><h2 style="color:#23a6d5">ƒêang k·∫øt n·ªëi...</h2></div>

<div class="container">
    <div class="progress-container"><div class="progress-fill" id="progressFill"></div></div>

    <div id="screen-login" class="screen active">
        <div class="login-box">
            <div class="logo-text">GAME<br>ONLINE</div>
            <p style="color: #777;">Nh·∫≠p t√™n ƒë·ªÉ tham gia</p>
            <input type="text" id="username" placeholder="T√™n c·ªßa b·∫°n...">
            <button class="btn" onclick="startQuiz()">B·∫ÆT ƒê·∫¶U üöÄ</button>
        </div>
    </div>

    <div id="screen-quiz" class="screen">
        <div class="quiz-header">
            <h2 id="questionText">C√¢u h·ªèi...</h2>
            <ul id="optionsList"></ul>
        </div>
    </div>

    <div id="screen-result" class="screen">
        <div class="result-box">
            <p style="color: #888; font-weight: bold; margin-bottom: 10px;">K·∫æT QU·∫¢ C·ª¶A B·∫†N</p>
            <div class="score-circle" id="finalScore">?</div>
            <h2 style="color: #333;">Ho√†n th√†nh!</h2>
            
            <div class="sv-msg">
                D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c g·ª≠i l√™n h·ªá th·ªëng.<br>
                <b>üëÄ H√£y nh√¨n l√™n M√†n h√¨nh ch√≠nh ƒë·ªÉ xem Th·ª© h·∫°ng!</b>
            </div>
        </div>
    </div>
</div>

<script>
    // -----------------------------------------------------------------
    // 1. C·∫§U H√åNH FIREBASE (D√ÅN CONFIG C·ª¶A B·∫†N V√ÄO ƒê√ÇY)
    // -----------------------------------------------------------------
    const firebaseConfig = {
        apiKey: "AIzaSyBpECks4WVAmu52z88_XBUpIkStvAddnHc",
        authDomain: "gametracnghiem-eb3bc.firebaseapp.com",
        projectId: "gametracnghiem-eb3bc",
        storageBucket: "gametracnghiem-eb3bc.firebasestorage.app",
        messagingSenderId: "971086229473",
        appId: "1:971086229473:web:5cd29727f0e92c61b96ca0"
    };

    if (!firebaseConfig.apiKey) alert("Ch∆∞a nh·∫≠p Firebase Config!");
    else firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // -----------------------------------------------------------------
    // 2. DATA C√ÇU H·ªéI
    // -----------------------------------------------------------------
    const quizData = [
        { q: "Th·ª´a k·∫ø ƒë∆∞·ª£c hi·ªÉu ƒë√∫ng nh·∫•t l√†: ", 
        a: [
            "A. Vi·ªác ph√¢n chia t√†i s·∫£n chung c·ªßa gia ƒë√¨nh.",
            "B. Vi·ªác chuy·ªÉn d·ªãch di s·∫£n c·ªßa ng∆∞·ªùi ch·∫øt cho ng∆∞·ªùi c√≤n s·ªëng theo di ch√∫c ho·∫∑c theo ph√°p lu·∫≠t.", 
            "C. Vi·ªác chuy·ªÉn d·ªãch t√†i s·∫£n c·ªßa ng∆∞·ªùi c√≤n s·ªëng cho ng∆∞·ªùi kh√°c ", 
            "D. Vi·ªác Nh√† n∆∞·ªõc thu h·ªìi t√†i s·∫£n c·ªßa c√° nh√¢n "
        ], 
        correct: 1 },

        { q: "Di s·∫£n th·ª´a k·∫ø theo quy ƒë·ªãnh c·ªßa ph√°p lu·∫≠t kh√¥ng bao g·ªìm n·ªôi dung n√†o sau ƒë√¢y? ", 
        a: [
            "A. T√†i s·∫£n ri√™ng c·ªßa ng∆∞·ªùi ch·∫øt", 
            "B. Ph·∫ßn t√†i s·∫£n c·ªßa ng∆∞·ªùi ch·∫øt trong t√†i s·∫£n chung", 
            "C. Quy·ªÅn s·ª≠ d·ª•ng ƒë·∫•t", 
            "D. C√°c quy·ªÅn, nghƒ©a v·ª• g·∫Øn li·ªÅn v·ªõi nh√¢n th√¢n c·ªßa ng∆∞·ªùi ch·∫øt"
        ], 
        correct: 3 },

        { q: "Ng∆∞·ªùi th·ª´a k·∫ø kh√¥ng ph·ª• thu·ªôc v√†o n·ªôi dung di ch√∫c theo B·ªô lu·∫≠t D√¢n s·ª± nƒÉm 2015 bao g·ªìm: ", 
        a: [
            "A. Anh, ch·ªã, em ru·ªôt c·ªßa ng∆∞·ªùi ch·∫øt", 
            "B. Con ƒë√£ th√†nh ni√™n v√† c√≥ kh·∫£ nƒÉng lao ƒë·ªông", 
            "C. Con ch∆∞a th√†nh ni√™n; cha, m·∫π; v·ª£, ch·ªìng c·ªßa ng∆∞·ªùi ch·∫øt", 
            "D. Ch√°u ru·ªôt c·ªßa ng∆∞·ªùi ch·∫øt"
        ], 
        correct: 2 },

        { q: "Th·ª´a k·∫ø theo ph√°p lu·∫≠t ƒë∆∞·ª£c √°p d·ª•ng trong tr∆∞·ªùng h·ª£p n√†o sau ƒë√¢y? ", 
        a: [
            "A. C√≥ di ch√∫c h·ª£p ph√°p", 
            "B. C√≥ di ch√∫c nh∆∞ng ng∆∞·ªùi l·∫≠p di ch√∫c c√≤n s·ªëng", 
            "C. Kh√¥ng c√≥ di ch√∫c ho·∫∑c di ch√∫c kh√¥ng h·ª£p ph√°p", 
            "D. Di ch√∫c c√≥ ng∆∞·ªùi l√†m ch·ª©ng"
        ], 
        correct: 2 },

        { q: "Theo quy ƒë·ªãnh c·ªßa ph√°p lu·∫≠t, h√†ng th·ª´a k·∫ø th·ª© nh·∫•t bao g·ªìm: ", 
        a: [
            "A. √îng b√† n·ªôi, ngo·∫°i v√† anh ch·ªã em ru·ªôt", 
            "B. V·ª£, ch·ªìng, cha m·∫π, con c·ªßa ng∆∞·ªùi ch·∫øt", 
            "C. C√¥, d√¨, ch√∫, b√°c ru·ªôt c·ªßa ng∆∞·ªùi ch·∫øt", 
            "D. Ch√°u ru·ªôt c·ªßa ng∆∞·ªùi ch·∫øt"
        ], 
        correct: 1 }
    ];

    // -----------------------------------------------------------------
    // 3. LOGIC H·ªÜ TH·ªêNG (C√≥ ch·∫∑n ch∆°i l·∫°i)
    // -----------------------------------------------------------------
    window.onload = () => {
        // Ki·ªÉm tra ƒë√£ ch∆°i ch∆∞a
        const hasPlayed = localStorage.getItem('quiz_played_status');
        const savedScore = localStorage.getItem('quiz_score');

        if (hasPlayed === 'true') {
            document.getElementById('loading').style.display = 'none';
            showResultScreen(savedScore);
        } else {
            setTimeout(() => {
                document.getElementById('loading').style.opacity = '0';
                setTimeout(()=>document.getElementById('loading').style.display='none', 500);
            }, 800);
        }
    };

    let currentQ = 0;
    let score = 0;
    let playerName = "";

    function startQuiz() {
        const nameInput = document.getElementById('username').value;
        if (!nameInput.trim()) return alert("Vui l√≤ng nh·∫≠p t√™n!");
        playerName = nameInput.trim();
        switchScreen('screen-quiz');
        loadQuestion();
    }

    function loadQuestion() {
        const q = quizData[currentQ];
        document.getElementById('questionText').innerText = `C√¢u ${currentQ + 1}: ${q.q}`;
        const ul = document.getElementById('optionsList');
        ul.innerHTML = '';
        ul.classList.remove('disabled');
        document.getElementById('progressFill').style.width = `${((currentQ) / quizData.length) * 100}%`;

        q.a.forEach((opt, index) => {
            const li = document.createElement('li');
            li.innerHTML = opt;
            li.onclick = () => checkAnswer(index, li);
            ul.appendChild(li);
        });
    }

    function checkAnswer(index, li) {
        const ul = document.getElementById('optionsList');
        if(ul.classList.contains('disabled')) return;
        ul.classList.add('disabled');
        
        const correctIndex = quizData[currentQ].correct;
        if (index === correctIndex) {
            li.classList.add('correct');
            score++;
        } else {
            li.classList.add('wrong');
            ul.children[correctIndex].classList.add('correct');
        }

        setTimeout(() => {
            currentQ++;
            if (currentQ < quizData.length) loadQuestion();
            else finishGame();
        }, 1200);
    }

    function finishGame() {
        document.getElementById('progressFill').style.width = '100%';
        
        // L∆∞u tr·∫°ng th√°i ƒë√£ ch∆°i
        localStorage.setItem('quiz_played_status', 'true');
        localStorage.setItem('quiz_score', score);

        showResultScreen(score);
        
        // Ch·ªâ g·ª≠i ƒëi·ªÉm l√™n, kh√¥ng t·∫£i b·∫£ng x·∫øp h·∫°ng v·ªÅ
        saveScoreToFirebase(playerName, score);
        fireConfetti();
    }

    function showResultScreen(finalScore) {
        switchScreen('screen-result');
        document.getElementById('finalScore').innerText = finalScore ? `${finalScore}/${quizData.length}` : "ƒê√£ Thi";
    }

    function switchScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }

    function saveScoreToFirebase(name, score) {
        const newScoreRef = db.ref('scores').push();
        newScoreRef.set({
            name: name,
            score: score,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
    }

    function fireConfetti() {
        var duration = 3 * 1000;
        var animationEnd = Date.now() + duration;
        var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
        var interval = setInterval(function() {
            var timeLeft = animationEnd - Date.now();
            if (timeLeft <= 0) return clearInterval(interval);
            var particleCount = 50 * (timeLeft / duration);
            confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
        }, 250);
    }

    // --- N√öT RESET ·∫®N ƒê·ªÇ B·∫†N TEST L·∫†I (N√∫t nh·ªè x√≠u g√≥c tr√°i d∆∞·ªõi) ---
    const resetBtn = document.createElement('button');
    resetBtn.innerText = "‚Ü∫";
    resetBtn.style.position = "fixed"; resetBtn.style.bottom = "5px"; resetBtn.style.left = "5px";
    resetBtn.style.opacity = "0.2"; resetBtn.style.border="none"; resetBtn.style.background="transparent";
    resetBtn.onclick = () => {
        if(confirm("Reset l∆∞·ª£t ch∆°i?")) {
            localStorage.removeItem('quiz_played_status');
            localStorage.removeItem('quiz_score');
            location.reload();
        }
    };
    document.body.appendChild(resetBtn);

</script>

</body>
</html>
